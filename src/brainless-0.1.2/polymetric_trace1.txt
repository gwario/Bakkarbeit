m
	?valid-move
		generate-moves
			new-moves
			append-moves
				(generate-moves)
					my-piece?
					my-piece?
					(generate-moves-from)
						select-moving-piece
						rook-moves
							straight-moves
							straight-moves
							straight-moves
							straight-moves
					my-piece?
					(generate-moves-from)
						select-moving-piece
						knight-moves
							strike?-move
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
												delta-xy>direction
												rook-threatens-through?
													piece-threatening-through
										add-move
											move,
												move!
							strike?-move
							strike?-move
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
												delta-xy>direction
												rook-threatens-through?
													piece-threatening-through
										add-move
											move,
												move!
							strike?-move
							strike?-move
							strike?-move
							strike?-move
							strike?-move
					my-piece?
					(generate-moves-from)
						select-moving-piece
						bishop-moves
							straight-moves
							straight-moves
							straight-moves
							straight-moves
					my-piece?
					(generate-moves-from)
						select-moving-piece
						queen-moves
							bishop-moves
								straight-moves
								straight-moves
								straight-moves
								straight-moves
							rook-moves
								straight-moves
								straight-moves
								straight-moves
								straight-moves
					my-piece?
					(generate-moves-from)
						select-moving-piece
						king-moves
							king-move
							king-move
							king-move
							king-move
							king-move
							king-move
							king-move
							king-move
							castle-near
								empty?
								empty?
								unmoved?
							castle-far
								empty?
								empty?
								empty?
								unmoved?
					my-piece?
					(generate-moves-from)
						select-moving-piece
						bishop-moves
							straight-moves
							straight-moves
							straight-moves
							straight-moves
					my-piece?
					(generate-moves-from)
						select-moving-piece
						knight-moves
							strike?-move
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
												delta-xy>direction
												rook-threatens-through?
													piece-threatening-through
										add-move
											move,
												move!
							strike?-move
							strike?-move
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
												delta-xy>direction
												rook-threatens-through?
													piece-threatening-through
										add-move
											move,
												move!
							strike?-move
							strike?-move
							strike?-move
							strike?-move
							strike?-move
					my-piece?
					(generate-moves-from)
						select-moving-piece
						rook-moves
							straight-moves
							straight-moves
							straight-moves
							straight-moves
					my-piece?
					my-piece?
					my-piece?
					(generate-moves-from)
						select-moving-piece
						pawn-moves
							?direction
							pawn-far-move
								empty?
								?direction
								empty?
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
										add-move
											move,
												move!
							?direction
							pawn-normal-move
								empty?
								pawn-trans?
								(generate-move-to)
									(generate-move-to-nocheck)
										might-cause-check?
											king-square
											queenlike-threatens-through?
												>delta-xy
												bishop-xy?
												rook-xy?
										add-move
											move,
												move!
							?direction
							pawn-strike-move
								opponent?
							strike-ep-move
								?direction
							?direction
							pawn-strike-move
								opponent?
							strike-ep-move
								?direction
					my-piece?
